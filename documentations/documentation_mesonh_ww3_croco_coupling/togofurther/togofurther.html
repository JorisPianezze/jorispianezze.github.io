

<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>7. To go further &#8212; Meso-NH/WW3/CROCO coupling 2.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/cloud.css?v=f9ae72be" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script src="../_static/documentation_options.js?v=51b770b3"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>

    
    
     
        <script src="../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../_static/cloud.base.js"></script>
    

    
     
        <script src="../_static/cloud.js"></script>
    

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="6. Simulation" href="../simulation/simulation.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../simulation/simulation.html" title="6. Simulation"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Meso-NH/WW3/CROCO coupling 2.0.0 documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href=""><span class="section-number">7. </span>To go further</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="to-go-further">
<h1><span class="section-number">7. </span>To go further<a class="headerlink" href="#to-go-further" title="Link to this heading">¶</a></h1>
<section id="oasis">
<span id="rst-oasis"></span><h2><span class="section-number">7.1. </span>OASIS<a class="headerlink" href="#oasis" title="Link to this heading">¶</a></h2>
<section id="introduction">
<h3><span class="section-number">7.1.1. </span>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h3>
<p>The information presented in this section is described in detail in the OASIS user guide (<a class="reference external" href="https://verc.enes.org/oasis/">https://verc.enes.org/oasis/</a>).
The OASIS source code is either available in the Meso-NH version in the src/LIB/oasis3-mct_5.0/ folder (if you are using a Meso-NH version greater than or equal to 5.3.0)
or by downloading it from the OASIS website.</p>
<p>To sum up, OASIS3-MCT is fully parallelized, has no executable specific to the coupler, is capable of managing 2d and 3d coupling field exchanges, is capable of supporting unstructured meshes, is capable of transferring fields in parallel, across all source or target component processes, has a namelist that allows the coupling characteristics to be changed without having to recompile the codes (type of interpolation, simulation duration, exchange time, etc.).</p>
</section>
<section id="installation-and-compilation">
<h3><span class="section-number">7.1.2. </span>Installation and compilation<a class="headerlink" href="#installation-and-compilation" title="Link to this heading">¶</a></h3>
<p>In the folder containing the OASIS code (src/LIB/oasis3-mct_5.0/), following directories are presented:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>doc/<span class="w">                 </span>:<span class="w"> </span>Documentation
lib/<span class="w">                 </span>:<span class="w"> </span>Libraries<span class="w"> </span>:<span class="w"> </span>mct,<span class="w"> </span>psmile<span class="w"> </span>and<span class="w"> </span>scrip
pyoasis/<span class="w">             </span>:<span class="w"> </span>API<span class="w"> </span><span class="k">for</span><span class="w"> </span>python
util/load_balancing/<span class="w"> </span>:<span class="w"> </span>Tools<span class="w"> </span><span class="k">for</span><span class="w"> </span>load<span class="w"> </span>balancing<span class="w"> </span>analysis
util/make_dir/<span class="w">       </span>:<span class="w"> </span>Makefiles
</pre></div>
</div>
<p>It is important to compile OASIS with the same libraries (NetCDF, MPI, etc.) as those that will be used that will be used for the code you wish to couple. So, if you decide to change one of these libraries, you will have to recompile OASIS and the codes
with this new library.</p>
<p>To compile OASIS manually, you need to modify the make.inc file in the util/make_dir folder according to the desired libraries, then
run the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>oasis_dir/util/make_dir/
make<span class="w"> </span>realclean<span class="w"> </span>-f<span class="w"> </span>TopMakefileOasis3
make<span class="w"> </span>-f<span class="w"> </span>TopMakefileOasis3
</pre></div>
</div>
</section>
<section id="functions-implemented-in-models">
<h3><span class="section-number">7.1.3. </span>Functions implemented in models<a class="headerlink" href="#functions-implemented-in-models" title="Link to this heading">¶</a></h3>
<p>Using OASIS involves an instrumentation phase which consists of placing the various calls to the OASIS3-MCT routines in the codes (in this case Meso-NH and
TOY). The use of a specific precompilation key is used if you want to compile Meso-NH linking to OASIS. This key is called CPLOASIS.</p>
<p>OASIS3-MCT is used in the following phases:</p>
<ul>
<li><p><strong>initialisation phase:</strong></p>
<ul class="simple">
<li><p>oasis_init_comp : initialization of the coupling</p></li>
<li><p>oasis_get_localcomm : creation by OASIS3-MCT of a local (to the model) MPI communicator. This new communicator must be used throughout the model (a precompilation key is used to force the model to use this communicator in the case of a coupled run).</p></li>
</ul>
</li>
<li><p><strong>definition of interpolation grids:</strong></p>
<p>The interpolation methods used in OASIS call files created during this step.
Once defined, the interpolation grids are stored in netcdf files: grids.nc, area.nc and mask.nc.
These files contain the grids for all the coupled models.
The OASIS functions used in this step are:</p>
<ul class="simple">
<li><p>oasis_start_grids_writing : starts writing grid files, masks, …</p></li>
<li><p>oasis_write_grid defines model grids (essential for CONSERV or SCRIP interpolation).</p></li>
<li><p>oasis_write_corner defines the corners of model grids: essential for CONSERV or SCRIP interpolation.)</p></li>
<li><p>oasis_write_mask defines the mask.</p></li>
<li><p>oasis_write_area which defines the area of the meshes</p></li>
<li><p>oasis_terminate_grids_writing which is used to finish writing.</p></li>
</ul>
<p>At the end of these stages, netcdf files are generated by OASIS: grids.nc, areas.nc and masks.nc with information about the different grids.
The creation of these files is completed by calling the oasis_enddef routine, which is located after the local partitions have been defined.
The creation of the grids requires the variables to be in global physical space (without the halo).</p>
</li>
<li><p><strong>definition of local partitions:</strong></p>
<p>description of the local partitions of each of the processes in the space of global indexes:</p>
<ul class="simple">
<li><p>oasis_def_partition: with the following main arguments:</p>
<ul>
<li><p>ig_paral: used to describe local partitions, in particular to say whether
in the case of sequential or parallel execution, and in the second case,
what type of partition it is</p></li>
<li><p>isize: used to specify the size of the global grid for which data is
data is actually exchanged. This optional parameter is
important, particularly when, for a given model, certain parts of its domain are not
are not included in the calculation. For example, for an ocean model
land points are excluded from the calculation but are still part of the
grid. OASIS is able to manage this situation thanks to this parameter.</p></li>
</ul>
</li>
</ul>
<p>At the end of this step, netcdf files with weights for interpolations (remapping) from one grid to another are generated: rmp*.nc.</p>
</li>
<li><p><strong>declaration of coupling fields:</strong></p>
<p>declare the fields that will be received and sent. These fields must all be identified in the namcouple described below. To do this, use the function:</p>
<ul class="simple">
<li><p>oasis_def_var</p></li>
</ul>
</li>
<li><p><strong>end of initialisation phase:</strong></p>
<ul class="simple">
<li><p>oasis_enddef: the grid definition files are created at this point.</p></li>
</ul>
</li>
<li><p><strong>exchange of coupling fields:</strong></p>
<p>calls to the routines that allow to send and receive data are placed in the model time-stepping.</p>
<ul class="simple">
<li><p>oasis_get : at the beginning of the loop to receive fields.</p></li>
<li><p>oasis_put : at the end of the time loop, to send fields.</p></li>
</ul>
<p>The coupled models cannot start at the same time because the fields are received at the beginning of the time loop (before they are sent).
It is therefore necessary to time-shift (the notion of LAG, which will be described later) the coupled models so that each oasis_get coincides with an oasis_put and vice versa.
The fields received by the model which first makes an oasis_get will come from a previously created rstrt.nc files.</p>
</li>
<li><p><strong>end of coupling:</strong></p>
<ul class="simple">
<li><p>oasis_terminate</p></li>
</ul>
</li>
</ul>
</section>
<section id="description-of-the-namcouple">
<h3><span class="section-number">7.1.4. </span>Description of the namcouple<a class="headerlink" href="#description-of-the-namcouple" title="Link to this heading">¶</a></h3>
<p>The namcouple file is the namelist for the OASIS coupler, which contains all the information relating to exchanges between models.
It follows a syntax which is clearly explained in the OASIS3-MCT user manual. There are no blank lines!
Since there is no syntax check on this file, the slightest error will result in a crash with no error indication.</p>
<p>First of all, we need to declare the general parameters of the coupled simulation: the number of coupling fields, the number of models, the name of the models (identical to what is given to OASIS via the oasis_init_comp routine): mesonh (for Meso-NH) and toyexe (for the toy model), the duration of the simulation in seconds (it has to be the same for both models).</p>
<p>All these parameters are used to write the first part of the namcouple.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is a typical input file for OASIS3-MCT.</span>
<span class="c1"># Keywords used in previous versions of OASIS3</span>
<span class="c1"># but now obsolete are marked &quot;Not used&quot;</span>
<span class="c1"># Don&#39;t hesitate to ask precisions or make suggestions (oasishelp@cerfacs.fr).</span>
<span class="c1">#</span>
<span class="c1"># Any line beginning with # is ignored. Blank lines are not allowed.</span>
<span class="c1">#</span>
<span class="c1">#########################################################################</span>
<span class="nv">$NFIELDS</span>
<span class="c1"># The number of fields described in the second part of the namcouple.</span>
<span class="c1">#</span>
<span class="w">            </span><span class="m">2</span>
<span class="nv">$END</span>
<span class="c1">#########################################################################</span>
<span class="nv">$NBMODEL</span>
<span class="c1"># The number of models in this experiment + their names (6 characters)</span>
<span class="c1">#</span>
<span class="w">  </span><span class="m">2</span><span class="w">  </span>mesonh<span class="w">   </span>toyexe
<span class="nv">$END</span>
<span class="c1">###########################################################################</span>
<span class="nv">$RUNTIME</span>
<span class="c1"># The total simulated time for this run in seconds</span>
<span class="c1">#</span>
<span class="w"> </span><span class="m">70</span>
<span class="nv">$END</span>
<span class="c1">###########################################################################</span>
<span class="nv">$NLOGPRT</span>
<span class="c1"># Amount of information written to OASIS3-MCT log files (see User Guide)</span>
<span class="c1"># Premier nombre: quantite d&#39;information pour debugger</span>
<span class="c1"># Second nombre: statistics des processeurs</span>
<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">3</span>
<span class="nv">$END</span>
</pre></div>
</div>
<p>The second part of the namcouple concerns exchanges between models. You need to have a precise idea of the coupling algorithm you want to implement.
you want to implement. First of all, we need to decide on a coupling period for the different fields.</p>
<p>It is not possible to give a coupling period shorter than the largest time step of the models.
In addition, the coupling period must be proportional to the model time steps and must be positive; reals are not allowed.
OASIS only sends data when a send date corresponds to a receive date,
It is therefore necessary to ensure that the coupling period is such that the two models can “meet”.</p>
<p>You also need to choose the type of interpolation for the transition from one grid to another.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible to choose different exchange periods and interpolations for each exchanged field.</p>
</div>
<p>We are particularly interested in the namcouple parameters for the exchange of SST exchange in the context of the coupling between Meso-NH and TOY. This case is sufficiently generic to be adapted to other exchanges:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="cp">#~~~~~~~~~~~</span>
<span class="cp"># Field 1 : SEA SURFACE TEMPERATURE</span>
<span class="cp">#~~~~~~~~~~~</span>
<span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">TOY__SST</span><span class="w"> </span><span class="n">MNH__SST</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">rstrt</span><span class="p">.</span><span class="n">nc</span><span class="w"> </span><span class="n">EXPOUT</span>
<span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="mi">321</span><span class="w"> </span><span class="mi">194</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="mi">87</span><span class="w"> </span><span class="n">toy</span><span class="w"> </span><span class="n">mnht</span><span class="w"> </span><span class="n">LAG</span><span class="o">=+</span><span class="mi">10</span>
<span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="mi">0</span>
<span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="n">LOCTRANS</span><span class="w"> </span><span class="n">BLASOLD</span><span class="w"> </span><span class="n">SCRIPR</span>
<span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="n">AVERAGE</span>
<span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="mi">1</span>
<span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="n">CONSTANT</span><span class="w"> </span><span class="mi">27</span><span class="mf">3.15</span>
<span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="n">BILINEAR</span><span class="w"> </span><span class="n">LR</span><span class="w"> </span><span class="n">SCALAR</span><span class="w"> </span><span class="n">LATLON</span><span class="w"> </span><span class="mi">1</span>
</pre></div>
</div>
<ul class="simple">
<li><p>(l.1) : here we have the field identifier, with the one on the source side (TOY__SST) and then the one on the target side (MNH__SST). The
following parameter is not used but must be present to ensure compatibility with the older version of OASIS. Next, we have the coupling period for this exchange
(10 seconds), the number of operations that will be applied to this field, the name of the restart file and the status of the field.</p></li>
<li><p>(l.2) : the dimensions of the source (toyt) and target (mnht) grids, their names and the value of the LAG where applicable.
if applicable. The grids here are those in the grids.nc, masks.nc and areas.nc files.</p></li>
<li><p>(l.3) : characteristics of the source and target grids (“R”: regional and “0”: no overlapping
overlap of grid points).</p></li>
<li><p>(l.4 à 8) : list of operations to be performed on this field, followed by the parameters for each of these
operations:</p>
<ul>
<li><p>LOCTRANS : temporal transformation - AVERAGE (l. 5)</p></li>
<li><p>BLASOLD: multiplication of the field by 1 (l. 6) to which is added the value 273.15 (l. 7): conversion from Kelvin to Celsius.</p></li>
<li><p>SCRIPR: interpolation whose parameters are supplied (l. 8): in this case bilinear interpolation</p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You need to repeat this block for each coupling fields.</p>
</div>
</section>
</section>
<section id="lag-concept">
<span id="rst-lag-concept"></span><h2><span class="section-number">7.2. </span>LAG concept<a class="headerlink" href="#lag-concept" title="Link to this heading">¶</a></h2>
<p>The figure ref{fig:coupled_simulation} shows an example of a coupled simulation between an atmospheric model and an ocean model to introduce the LAG concept explained in detail in the OASIS documentation. The purpose of this diagram is to present the role of the files rstrt_SAVE.nc (rst_A.nc and rst_O.nc) which you will have to create in the chapter concerning the preparation of configurations (Chapter ref{ch:prepa_config}). \</p>
<figure class="align-default" id="id1">
<img alt="../_images/temporal_lag.png" src="../_images/temporal_lag.png" />
<figcaption>
<p><span class="caption-text">At the initial instant (t=ini), the atmospheric and oceanic models receive the coupling fields located in the rtsrt.nc files. As soon as the models reach a simulation time that is a multiple of the exchange time (at t=exchange time),
the models exchange the fields. At the end of the simulation (at t=end), the exchanged fields are stored in the rstrt.nc files, which can be used at the start of the next simulation. \</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the fields contained in the rstrt.nc files will be overwritten at the end of the simulation, so it is important to copy them and not to make a symbolic link to these files if you wish to keep a trace of the files used to initialise this simulation. \</p>
</div>
</section>
<section id="meso-nh-surfex">
<span id="rst-details-mnh"></span><h2><span class="section-number">7.3. </span>Meso-NH/SurfEx<a class="headerlink" href="#meso-nh-surfex" title="Link to this heading">¶</a></h2>
<p>77 functions have been modified/created to cover the implementation of coupling in Meso-NH/SurfEx: 9 functions concern Meso-NH and 66 SurfEx.
These functions are described in the routines. Only the tree structure and the steps for compiling Meso-NH are described in this section.</p>
<section id="tree-structure-of-meso-nh-surfex">
<h3><span class="section-number">7.3.1. </span>Tree structure of Meso-NH/SurfEx<a class="headerlink" href="#tree-structure-of-meso-nh-surfex" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--<span class="w"> </span>mesonh.f90
<span class="w">  </span><span class="p">|</span>--<span class="w"> </span>sfx_oasis_init.f90
<span class="w">      </span><span class="p">|</span>--<span class="w"> </span>OASIS<span class="w"> </span>*oasis_init_comp*
<span class="w">      </span><span class="p">|</span>--<span class="w"> </span>OASIS<span class="w"> </span>*oasis_get_localcomm*
<span class="w">  </span><span class="p">|</span>--<span class="w"> </span>init_mnh.f90
<span class="w">      </span><span class="p">|</span>--<span class="w"> </span>init_ground_paramn.f90
<span class="w">          </span><span class="p">|</span>--<span class="w"> </span>init_surf_atmn.f90
<span class="w">              </span><span class="p">|</span>--<span class="w"> </span>init_sean.f90
<span class="w">                  </span><span class="p">|</span>--<span class="w"> </span>init_seafluxn.f90
<span class="w">  </span><span class="p">|</span>--<span class="w"> </span>sfx_oasis_read_nam.f90
<span class="w">  </span><span class="p">|</span>--<span class="w"> </span>mnh_oasis_grid.f90
<span class="w">      </span><span class="p">|</span>--<span class="w"> </span>OASIS<span class="w"> </span>*oasis_start_grids_writing*
<span class="w">      </span><span class="p">|</span>--<span class="w"> </span>OASIS<span class="w"> </span>*oasis_write_grid*
<span class="w">      </span><span class="p">|</span>--<span class="w"> </span>OASIS<span class="w"> </span>*oasis_write_corner*
<span class="w">      </span><span class="p">|</span>--<span class="w"> </span>OASIS<span class="w"> </span>*oasis_write_area*
<span class="w">      </span><span class="p">|</span>--<span class="w"> </span>OASIS<span class="w"> </span>*oasis_write_mask*
<span class="w">      </span><span class="p">|</span>--<span class="w"> </span>OASIS<span class="w"> </span>*oasis_terminate_grids_writing*
<span class="w">  </span><span class="p">|</span>--<span class="w"> </span>mnh_oasis_define.f90
<span class="w">      </span><span class="p">|</span>--<span class="w"> </span>sfx_oasis_define.f90
<span class="w">          </span><span class="p">|</span>--<span class="w"> </span>OASIS<span class="w"> </span>*oasis_def_partition*
<span class="w">          </span><span class="p">|</span>--<span class="w"> </span>OASIS<span class="w"> </span>*oasis_def_var*
<span class="w">          </span><span class="p">|</span>--<span class="w"> </span>OASIS<span class="w"> </span>*oasis_enddef*
<span class="w">  </span><span class="p">|</span>**<span class="w"> </span>start<span class="w"> </span>time-stepping<span class="w"> </span>**<span class="p">|</span>
<span class="w">  </span><span class="p">|</span>--<span class="w"> </span>modeln.f90
<span class="w">  </span><span class="p">|</span>--<span class="w"> </span>phys_paramn.f90
<span class="w">      </span><span class="p">|</span>--<span class="w"> </span>ground_paramn.f90
<span class="w">          </span><span class="p">|</span>--<span class="w"> </span>mnh_oasis_recv.f90
<span class="w">              </span><span class="p">|</span>--<span class="w"> </span>sfx_oasis_recv.f90
<span class="w">                  </span><span class="p">|</span>--<span class="w"> </span>OASIS<span class="w"> </span>*oasis_get*
<span class="w">              </span><span class="p">|</span>--<span class="w"> </span>put_sfxcpln.f90
<span class="w">                  </span><span class="p">|</span>--<span class="w"> </span>put_sfx_land.f90
<span class="w">                  </span><span class="p">|</span>--<span class="w"> </span>put_sfx_sea.f90
<span class="w">                  </span><span class="p">|</span>--<span class="w"> </span>put_sfx_wave.f90
<span class="w">          </span><span class="p">|</span>**<span class="w"> </span>go<span class="w"> </span>to<span class="w"> </span>SurfEx<span class="w"> </span>**<span class="p">|</span>
<span class="w">          </span><span class="p">|</span>--<span class="w"> </span>coupling_surf_atmn.f90
<span class="w">              </span><span class="p">|</span>--<span class="w"> </span>coupling_sean.f90
<span class="w">                  </span><span class="p">|</span>--<span class="w"> </span>coupling_seaflux_orogn.f90
<span class="w">                      </span><span class="p">|</span>--<span class="w"> </span>coupling_seawat_sbln.F90
<span class="w">                          </span><span class="p">|</span>--<span class="w"> </span>coupling_seafluxn.f90
<span class="w">                              </span><span class="p">|</span>--<span class="w"> </span>coare30_seaflux.f90
<span class="w">                                  </span><span class="p">|</span>--<span class="w"> </span>coare30_flux.f90
<span class="w">          </span><span class="p">|</span>**<span class="w"> </span>end<span class="w"> </span>of<span class="w"> </span>SurfEx<span class="w"> </span>**<span class="p">|</span>
<span class="w">          </span><span class="p">|</span>--<span class="w"> </span>mnh_oasis_send.f90
<span class="w">              </span><span class="p">|</span>--<span class="w"> </span>get_sfx_lake.f90
<span class="w">              </span><span class="p">|</span>--<span class="w"> </span>get_sfx_land.f90
<span class="w">              </span><span class="p">|</span>--<span class="w"> </span>get_sfx_sea.f90
<span class="w">              </span><span class="p">|</span>--<span class="w"> </span>get_sfx_wave.f90
<span class="w">              </span><span class="p">|</span>--<span class="w"> </span>sfx_oasis_send.f90
<span class="w">                  </span><span class="p">|</span>--<span class="w"> </span>OASIS<span class="w"> </span>*oasis_put*
<span class="w">   </span><span class="p">|</span>**<span class="w"> </span>end<span class="w"> </span>of<span class="w"> </span>time-stepping<span class="w"> </span>**<span class="p">|</span>
<span class="w">   </span><span class="p">|</span>--<span class="w"> </span>sfx_oasis_end.f90
<span class="w">       </span><span class="p">|</span>--<span class="w"> </span>OASIS<span class="w"> </span>*oasis_terminate*
</pre></div>
</div>
</section>
<section id="preparing-initial-files-for-meso-nh">
<h3><span class="section-number">7.3.2. </span>Preparing initial files for Meso-NH<a class="headerlink" href="#preparing-initial-files-for-meso-nh" title="Link to this heading">¶</a></h3>
<p>The coupling only affects the simulation (MESONH executable). The initial Meso-NH files for a simulation are therefore obtained in the same way as for a forced simulation.
as for a forced simulation. The initial files will come from the PREP_PGD and PREP_REAL_CASE or PREP_IDEAL_CASE stages.</p>
<p>It is necessary to have an rstrt.nc file which will allow the model starting first, which needs to receive a field via oasis_get, to read the field in the rstrt.nc file.
This rstrt.nc file can be created using the python script used in KTEST.</p>
</section>
<section id="description-of-the-exseg1-nam">
<h3><span class="section-number">7.3.3. </span>Description of the EXSEG1.nam<a class="headerlink" href="#description-of-the-exseg1-nam" title="Link to this heading">¶</a></h3>
<p>Namelists specific to the coupling have been created and are presented below. The other namelists for EXSEG1.nam are identical to an uncoupled simulation.</p>
<section id="nam-oasis">
<h4><span class="section-number">7.3.3.1. </span>&amp;NAM_OASIS<a class="headerlink" href="#nam-oasis" title="Link to this heading">¶</a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Signification</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>LOASIS</p></td>
<td><p>LOGICAL</p></td>
<td><p>.False.</p></td>
<td><p>Activate OASIS</p></td>
</tr>
<tr class="row-odd"><td><p>LOASIS_GRID</p></td>
<td><p>LOGICAL</p></td>
<td><p>.False.</p></td>
<td><p>Create grids and rmp files</p></td>
</tr>
<tr class="row-even"><td><p>CMODEL_NAME</p></td>
<td><p>CHARACTER</p></td>
<td><p>‘mesonh’</p></td>
<td><p>Model name</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CMODEL_NAME name must the same as the one in namcouple.</p>
</div>
</section>
<section id="nam-sfx-sea-cpl">
<h4><span class="section-number">7.3.3.2. </span>&amp;NAM_SFX_SEA_CPL<a class="headerlink" href="#nam-sfx-sea-cpl" title="Link to this heading">¶</a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Signification</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>XTSTEP_CPL_SEA</p></td>
<td><p>REAL</p></td>
<td><p>-1.0</p></td>
<td><p>Coupling time-step for oceanic fields</p></td>
</tr>
<tr class="row-odd"><td><p>CSEA_FWSU</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the u-momentum flux (send)</p></td>
</tr>
<tr class="row-even"><td><p>CSEA_FWSV</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the v-momentum flux (send)</p></td>
</tr>
<tr class="row-odd"><td><p>CSEA_HEAT</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the non-solar heat flux (send)</p></td>
</tr>
<tr class="row-even"><td><p>CSEA_SNET</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the solar flux (send)</p></td>
</tr>
<tr class="row-odd"><td><p>CSEA_WIND</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the wind speed (send)</p></td>
</tr>
<tr class="row-even"><td><p>CSEA_FWSM</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the momentum flux (send)</p></td>
</tr>
<tr class="row-odd"><td><p>CSEA_EVAP</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the evaporation flux (send)</p></td>
</tr>
<tr class="row-even"><td><p>CSEA_RAIN</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the rain flux (send)</p></td>
</tr>
<tr class="row-odd"><td><p>CSEA_SNOW</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the snow flux (send)</p></td>
</tr>
<tr class="row-even"><td><p>CSEA_WATF</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the freshwater flux (send)</p></td>
</tr>
<tr class="row-odd"><td><p>CSEA_PRES</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the surface pressure (send)</p></td>
</tr>
<tr class="row-even"><td><p>CSEA_SST</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the sea surface temperature (received)</p></td>
</tr>
<tr class="row-odd"><td><p>CSEA_UCU</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the u-surface current (received)</p></td>
</tr>
<tr class="row-even"><td><p>CSEA_VCU</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the v-surface current (received)</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The CSEA_* character strings correspond to the OASIS names of the variables exchanged between the ocean and the atmosphere and must be identical to those present in the namcouple. This identifier must be 8 characters long. An empty space of 8 characters corresponds to the default value: no exchange of this variable.</p></li>
<li><p>XTSTEP_CPL_SEA equal to -1 indicates no coupling with the ocean.</p></li>
</ul>
</div>
</section>
<section id="nam-sfx-wave-cpl">
<h4><span class="section-number">7.3.3.3. </span>&amp;NAM_SFX_WAVE_CPL<a class="headerlink" href="#nam-sfx-wave-cpl" title="Link to this heading">¶</a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Signification</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>XTSTEP_CPL_WAVE</p></td>
<td><p>REAL</p></td>
<td><p>-1.0</p></td>
<td><p>Coupling time-step for wave fields</p></td>
</tr>
<tr class="row-odd"><td><p>CWAVE_U10</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the 10m u-wind speed (send)</p></td>
</tr>
<tr class="row-even"><td><p>CWAVE_V10</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the 10m v-wind speed (send)</p></td>
</tr>
<tr class="row-odd"><td><p>CWAVE_CHA</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the Charnock coefficient (received)</p></td>
</tr>
<tr class="row-even"><td><p>CWAVE_UCU</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the u-surface current (received)</p></td>
</tr>
<tr class="row-odd"><td><p>CWAVE_VCU</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the v-surface current (received)</p></td>
</tr>
<tr class="row-even"><td><p>CWAVE_HS</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the significant wave height (received)</p></td>
</tr>
<tr class="row-odd"><td><p>CWAVE_TP</p></td>
<td><p>CHARACTER(LEN=8)</p></td>
<td><p>-</p></td>
<td><p>OASIS name for the peak period (received)</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The CWAVE_* character strings correspond to the OASIS names of the variables exchanged between the oceanic wave and the atmosphere and must be identical to those present in the namcouple. This identifier must be 8 characters long. An empty space of 8 characters corresponds to the default value: no exchange of this variable.</p></li>
<li><p>XTSTEP_CPL_WAVE equal to -1 indicates no coupling with the oceanic wave.</p></li>
<li><p>The choice of the parameterisation of turbulent fluxes with waves is made with &amp;NAM_SEAFLUXn NGRWAVES and is only available with CSEA_FLUX=’COARE3’. Please refer to the <a class="reference external" href="https://www.umr-cnrm.fr/surfex/">SURFEX</a> documentation for more details.</p></li>
</ul>
</div>
</section>
<section id="example-namelist-exseg1-nam-for-an-ocean-wave-atmosphere-coupling">
<h4><span class="section-number">7.3.3.4. </span>Example namelist EXSEG1.nam for an Ocean-Wave-Atmosphere coupling<a class="headerlink" href="#example-namelist-exseg1-nam-for-an-ocean-wave-atmosphere-coupling" title="Link to this heading">¶</a></h4>
<p>Below is an example of a namelist for a simulation with Meso-NH. The creation of the grids is desired during the simulation. The model identifier is “mesonh” and this name must be identical to that of the namcouple. Coupling with wave and ocean models is desired. Fields with identifiers are exchanged every 100s.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="p">&amp;</span><span class="n">NAM_OASIS</span><span class="w"> </span><span class="n">LOASIS</span><span class="o">=</span><span class="p">.</span><span class="n">TRUE</span><span class="p">.,</span>
<span class="w">           </span><span class="n">LOASIS_GRID</span><span class="o">=</span><span class="p">.</span><span class="n">TRUE</span><span class="p">.,</span>
<span class="w">           </span><span class="n">CMODEL_NAME</span><span class="o">=</span><span class="s1">&#39;mesonh&#39;</span><span class="w"> </span><span class="o">/</span>

<span class="p">&amp;</span><span class="n">NAM_SFX_SEA_CPL</span><span class="w"> </span><span class="n">XTSTEP_CPL_SEA</span><span class="w">  </span><span class="o">=</span><span class="w">  </span><span class="mi">10</span><span class="mf">0.</span><span class="p">,</span>
<span class="w">                 </span><span class="n">CSEA_FWSU</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH_FMSU&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="n">CSEA_FWSV</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH_FMSV&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="n">CSEA_HEAT</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH_HEAT&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="n">CSEA_SNET</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH_SNET&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="n">CSEA_WIND</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;        &#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="n">CSEA_FWSM</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;        &#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="n">CSEA_EVAP</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH_EVAP&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="n">CSEA_RAIN</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH_RAIN&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="n">CSEA_SNOW</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;        &#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="n">CSEA_WATF</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;        &#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="n">CSEA_PRES</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH_PRES&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="n">CSEA_SST</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH__SST&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="n">CSEA_UCU</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH_UCUR&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="n">CSEA_VCU</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH_VCUR&#39;</span><span class="w"> </span><span class="o">/</span>

<span class="p">&amp;</span><span class="n">NAM_SFX_WAVE_CPL</span><span class="w"> </span><span class="n">XTSTEP_CPL_WAVE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="mf">0.0</span><span class="p">,</span>
<span class="w">                  </span><span class="n">CWAVE_U10</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH__U10&#39;</span><span class="p">,</span>
<span class="w">                  </span><span class="n">CWAVE_V10</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH__V10&#39;</span><span class="p">,</span>
<span class="w">                  </span><span class="n">CWAVE_CHA</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH__CHA&#39;</span><span class="p">,</span>
<span class="w">                  </span><span class="n">CWAVE_US</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH___US&#39;</span><span class="p">,</span>
<span class="w">                  </span><span class="n">CWAVE_VS</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH___VS&#39;</span><span class="p">,</span>
<span class="w">                  </span><span class="n">CWAVE_HS</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH___HS&#39;</span><span class="p">,</span>
<span class="w">                  </span><span class="n">CWAVE_TP</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MNH___TP&#39;</span><span class="w"> </span><span class="o">/</span>

<span class="p">&amp;</span><span class="n">NAM_DIAG_SURFn</span><span class="w"> </span><span class="n">N2M</span><span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="o">/</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You need to use &amp;NAM_DIAG_SURFn N2M=2 / namelist in order to compute sea surface fluxes.
The rest of the namelist is identical to the case without coupling.</p>
</div>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
<div class="sphinx-toc sphinxglobaltoc">
<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../requirements/requirements.html">2. Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html">3. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compilation/compilation.html">4. Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preprocessing/preprocessing.html">5. Pre-processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simulation/simulation.html">6. Simulation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">7. To go further</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#oasis">7.1. OASIS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">7.1.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installation-and-compilation">7.1.2. Installation and compilation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functions-implemented-in-models">7.1.3. Functions implemented in models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#description-of-the-namcouple">7.1.4. Description of the namcouple</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#lag-concept">7.2. LAG concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="#meso-nh-surfex">7.3. Meso-NH/SurfEx</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tree-structure-of-meso-nh-surfex">7.3.1. Tree structure of Meso-NH/SurfEx</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preparing-initial-files-for-meso-nh">7.3.2. Preparing initial files for Meso-NH</a></li>
<li class="toctree-l3"><a class="reference internal" href="#description-of-the-exseg1-nam">7.3.3. Description of the EXSEG1.nam</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/togofurther/togofurther.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../simulation/simulation.html" title="6. Simulation"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Meso-NH/WW3/CROCO coupling 2.0.0 documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href=""><span class="section-number">7. </span>To go further</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2025, J. Pianezze.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>